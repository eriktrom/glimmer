class DOMOpcode {
    constructor() {
        this.next = null;
        this.prev = null;
    }
}
class DOMUpdatingOpcode {
    constructor() {
        this.next = null;
        this.prev = null;
    }
}
export class TextOpcode extends DOMOpcode {
    constructor(text) {
        super();
        this.type = "text";
        this.text = text;
    }
    evaluate(vm) {
        vm.stack().appendText(this.text);
    }
}
export class OpenPrimitiveElementOpcode extends DOMOpcode {
    constructor(tag) {
        super();
        this.type = "open-primitive-element";
        this.tag = tag;
    }
    evaluate(vm) {
        vm.stack().openElement(this.tag);
    }
}
export class CloseElementOpcode extends DOMOpcode {
    constructor(...args) {
        super(...args);
        this.type = "close-element";
    }
    evaluate(vm) {
        let { element, classList, classNames } = vm.stack().closeElement();
        if (classList) {
            vm.updateWith(new UpdateAttributeOpcode(element, "class", classList, classNames));
        }
    }
}
export class StaticAttrOpcode extends DOMOpcode {
    constructor(attr) {
        super();
        this.type = "static-attr";
        this.name = attr.name;
        this.value = attr.value;
        this.namespace = attr.namespace;
    }
    evaluate(vm) {
        let { name, value, namespace } = this;
        if (this.namespace) {
            vm.stack().setAttributeNS(name, value, namespace);
        }
        else {
            vm.stack().setAttribute(name, value);
        }
    }
}
export class DynamicAttrOpcode extends DOMOpcode {
    constructor(attr) {
        super();
        this.type = "dynamic-attr";
        this.name = attr.name;
        this.namespace = attr.namespace;
    }
    evaluate(vm) {
        let { name, namespace } = this;
        let reference = vm.frame.getOperand();
        let value = reference.value();
        if (this.namespace) {
            vm.stack().setAttributeNS(name, value, namespace);
        }
        else {
            vm.stack().setAttribute(name, value);
        }
        vm.updateWith(new UpdateAttributeOpcode(vm.stack().element, name, reference, value));
    }
}
export class UpdateAttributeOpcode extends DOMUpdatingOpcode {
    constructor(element, name, reference, lastValue, namespace) {
        super();
        this.type = "update-attribute";
        this.element = element;
        this.name = name;
        this.reference = reference;
        this.lastValue = lastValue;
        this.namespace = namespace;
    }
    evaluate(vm) {
        let value = this.reference.value();
        if (value !== this.lastValue) {
            if (this.namespace) {
                vm.dom.setAttributeNS(this.element, this.name, value, this.namespace);
            }
            else {
                vm.dom.setAttribute(this.element, this.name, value);
            }
            this.lastValue = value;
        }
    }
}
export class DynamicPropOpcode extends DOMOpcode {
    constructor(attr) {
        super();
        this.type = "dynamic-prop";
        this.name = attr.name;
    }
    evaluate(vm) {
        let { name } = this;
        let element = vm.stack().element;
        let reference = vm.frame.getOperand();
        let value = reference.value();
        element[name] = value;
        vm.updateWith(new UpdatePropertyOpcode(element, name, reference, value));
    }
}
export class UpdatePropertyOpcode extends DOMUpdatingOpcode {
    constructor(element, name, reference, lastValue) {
        super();
        this.type = "update-property";
        this.element = element;
        this.name = name;
        this.reference = reference;
        this.lastValue = lastValue;
    }
    evaluate(vm) {
        let value = this.reference.value();
        if (value !== this.lastValue) {
            this.lastValue = this.element[this.name] = value;
        }
    }
}
export class AddClassOpcode extends DOMOpcode {
    constructor(...args) {
        super(...args);
        this.type = "add-class";
    }
    evaluate(vm) {
        vm.stack().addClass(vm.frame.getOperand());
    }
}
export class CommentOpcode extends DOMOpcode {
    constructor(comment) {
        super();
        this.type = "comment";
        this.value = comment.value;
    }
    evaluate(vm) {
        vm.stack().appendComment(this.value);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9tLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZ2xpbW1lci1ydW50aW1lL2xpYi9jb21waWxlZC9vcGNvZGVzL2RvbS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFNQTtJQUFBO1FBRVMsU0FBSSxHQUFHLElBQUksQ0FBQztRQUNaLFNBQUksR0FBRyxJQUFJLENBQUM7SUFHckIsQ0FBQztBQUFELENBQUM7QUFFRDtJQUFBO1FBRVMsU0FBSSxHQUFHLElBQUksQ0FBQztRQUNaLFNBQUksR0FBRyxJQUFJLENBQUM7SUFHckIsQ0FBQztBQUFELENBQUM7QUFFRCxnQ0FBZ0MsU0FBUztJQUl2QyxZQUFZLElBQW9CO1FBQzlCLE9BQU8sQ0FBQztRQUpILFNBQUksR0FBRyxNQUFNLENBQUM7UUFLbkIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFDbkIsQ0FBQztJQUVELFFBQVEsQ0FBQyxFQUFNO1FBQ2IsRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkMsQ0FBQztBQUNILENBQUM7QUFFRCxnREFBZ0QsU0FBUztJQUl2RCxZQUFZLEdBQW1CO1FBQzdCLE9BQU8sQ0FBQztRQUpILFNBQUksR0FBRyx3QkFBd0IsQ0FBQztRQUtyQyxJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztJQUNqQixDQUFDO0lBRUQsUUFBUSxDQUFDLEVBQU07UUFDYixFQUFFLENBQUMsS0FBSyxFQUFFLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNuQyxDQUFDO0FBQ0gsQ0FBQztBQUVELHdDQUF3QyxTQUFTO0lBQWpEO1FBQXdDLGVBQVM7UUFDeEMsU0FBSSxHQUFHLGVBQWUsQ0FBQztJQVNoQyxDQUFDO0lBUEMsUUFBUSxDQUFDLEVBQU07UUFDYixJQUFJLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLENBQUMsS0FB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Q0FBQyxLQUFLLENBQUM7SUFDN0IsQ0FBQztJQUVELFFBQVEsQ0FBQyxFQUFNO1FBQ2IsRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdkMsQ0FBQztBQUNILENBQUM7QUFBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9wY29kZSwgVXBkYXRpbmdPcGNvZGUgfSBmcm9tICcuLi8uLi9vcGNvZGVzJztcbmltcG9ydCB7IFZNLCBVcGRhdGluZ1ZNIH0gZnJvbSAnLi4vLi4vdm0nO1xuaW1wb3J0IHsgSW50ZXJuZWRTdHJpbmcgfSBmcm9tICdnbGltbWVyLXV0aWwnO1xuaW1wb3J0IHsgU3RhdGljQXR0ciwgRHluYW1pY0F0dHIsIER5bmFtaWNQcm9wLCBDb21tZW50IH0gZnJvbSAnLi4vLi4vc3ludGF4L2NvcmUnO1xuaW1wb3J0IHsgQ2hhaW5hYmxlUmVmZXJlbmNlIH0gZnJvbSAnZ2xpbW1lci1yZWZlcmVuY2UnO1xuXG5hYnN0cmFjdCBjbGFzcyBET01PcGNvZGUgaW1wbGVtZW50cyBPcGNvZGUge1xuICBwdWJsaWMgdHlwZTogc3RyaW5nO1xuICBwdWJsaWMgbmV4dCA9IG51bGw7XG4gIHB1YmxpYyBwcmV2ID0gbnVsbDtcblxuICBhYnN0cmFjdCBldmFsdWF0ZSh2bTogVk0pO1xufVxuXG5hYnN0cmFjdCBjbGFzcyBET01VcGRhdGluZ09wY29kZSBpbXBsZW1lbnRzIFVwZGF0aW5nT3Bjb2RlIHtcbiAgcHVibGljIHR5cGU6IHN0cmluZztcbiAgcHVibGljIG5leHQgPSBudWxsO1xuICBwdWJsaWMgcHJldiA9IG51bGw7XG5cbiAgYWJzdHJhY3QgZXZhbHVhdGUodm06IFVwZGF0aW5nVk0pO1xufVxuXG5leHBvcnQgY2xhc3MgVGV4dE9wY29kZSBleHRlbmRzIERPTU9wY29kZSB7XG4gIHB1YmxpYyB0eXBlID0gXCJ0ZXh0XCI7XG4gIHByaXZhdGUgdGV4dDogSW50ZXJuZWRTdHJpbmc7XG5cbiAgY29uc3RydWN0b3IodGV4dDogSW50ZXJuZWRTdHJpbmcpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMudGV4dCA9IHRleHQ7XG4gIH1cblxuICBldmFsdWF0ZSh2bTogVk0pIHtcbiAgICB2bS5zdGFjaygpLmFwcGVuZFRleHQodGhpcy50ZXh0KTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgT3BlblByaW1pdGl2ZUVsZW1lbnRPcGNvZGUgZXh0ZW5kcyBET01PcGNvZGUge1xuICBwdWJsaWMgdHlwZSA9IFwib3Blbi1wcmltaXRpdmUtZWxlbWVudFwiO1xuICBwcml2YXRlIHRhZzogSW50ZXJuZWRTdHJpbmc7XG5cbiAgY29uc3RydWN0b3IodGFnOiBJbnRlcm5lZFN0cmluZykge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy50YWcgPSB0YWc7XG4gIH1cblxuICBldmFsdWF0ZSh2bTogVk0pIHtcbiAgICB2bS5zdGFjaygpLm9wZW5FbGVtZW50KHRoaXMudGFnKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQ2xvc2VFbGVtZW50T3Bjb2RlIGV4dGVuZHMgRE9NT3Bjb2RlIHtcbiAgcHVibGljIHR5cGUgPSBcImNsb3NlLWVsZW1lbnRcIjtcblxuICBldmFsdWF0ZSh2bTogVk0pIHtcbiAgICBsZXQgeyBlbGVtZW50LCBjbGFzc0xpc3QsIGNsYXNzTmFtZXMgfSA9IHZtLnN0YWNrKCkuY2xvc2VFbGVtZW50KCk7XG5cbiAgICBpZiAoY2xhc3NMaXN0KSB7XG4gICAgICB2bS51cGRhdGVXaXRoKG5ldyBVcGRhdGVBdHRyaWJ1dGVPcGNvZGUoZWxlbWVudCwgXCJjbGFzc1wiLCBjbGFzc0xpc3QsIGNsYXNzTmFtZXMpKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFN0YXRpY0F0dHJPcGNvZGUgZXh0ZW5kcyBET01PcGNvZGUge1xuICBwdWJsaWMgdHlwZSA9IFwic3RhdGljLWF0dHJcIjtcbiAgcHVibGljIG5hbWU6IEludGVybmVkU3RyaW5nO1xuICBwdWJsaWMgdmFsdWU6IEludGVybmVkU3RyaW5nO1xuICBwdWJsaWMgbmFtZXNwYWNlOiBJbnRlcm5lZFN0cmluZztcblxuICBjb25zdHJ1Y3RvcihhdHRyOiBTdGF0aWNBdHRyKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLm5hbWUgPSBhdHRyLm5hbWU7XG4gICAgdGhpcy52YWx1ZSA9IGF0dHIudmFsdWU7XG4gICAgdGhpcy5uYW1lc3BhY2UgPSBhdHRyLm5hbWVzcGFjZTtcbiAgfVxuXG4gIGV2YWx1YXRlKHZtOiBWTSkge1xuICAgIGxldCB7IG5hbWUsIHZhbHVlLCBuYW1lc3BhY2UgfSA9IHRoaXM7XG5cbiAgICBpZiAodGhpcy5uYW1lc3BhY2UpIHtcbiAgICAgIHZtLnN0YWNrKCkuc2V0QXR0cmlidXRlTlMobmFtZSwgdmFsdWUsIG5hbWVzcGFjZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZtLnN0YWNrKCkuc2V0QXR0cmlidXRlKG5hbWUsIHZhbHVlKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIER5bmFtaWNBdHRyT3Bjb2RlIGV4dGVuZHMgRE9NT3Bjb2RlIHtcbiAgcHVibGljIHR5cGUgPSBcImR5bmFtaWMtYXR0clwiO1xuICBwdWJsaWMgbmFtZTogSW50ZXJuZWRTdHJpbmc7XG4gIHB1YmxpYyB2YWx1ZTogSW50ZXJuZWRTdHJpbmc7XG4gIHB1YmxpYyBuYW1lc3BhY2U6IEludGVybmVkU3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKGF0dHI6IER5bmFtaWNBdHRyKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLm5hbWUgPSBhdHRyLm5hbWU7XG4gICAgdGhpcy5uYW1lc3BhY2UgPSBhdHRyLm5hbWVzcGFjZTtcbiAgfVxuXG4gIGV2YWx1YXRlKHZtOiBWTSkge1xuICAgIGxldCB7IG5hbWUsIG5hbWVzcGFjZSB9ID0gdGhpcztcbiAgICBsZXQgcmVmZXJlbmNlID0gdm0uZnJhbWUuZ2V0T3BlcmFuZCgpO1xuICAgIGxldCB2YWx1ZSA9IHJlZmVyZW5jZS52YWx1ZSgpO1xuXG4gICAgaWYgKHRoaXMubmFtZXNwYWNlKSB7XG4gICAgICB2bS5zdGFjaygpLnNldEF0dHJpYnV0ZU5TKG5hbWUsIHZhbHVlLCBuYW1lc3BhY2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICB2bS5zdGFjaygpLnNldEF0dHJpYnV0ZShuYW1lLCB2YWx1ZSk7XG4gICAgfVxuXG4gICAgdm0udXBkYXRlV2l0aChuZXcgVXBkYXRlQXR0cmlidXRlT3Bjb2RlKHZtLnN0YWNrKCkuZWxlbWVudCwgbmFtZSwgcmVmZXJlbmNlLCB2YWx1ZSkpO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBVcGRhdGVBdHRyaWJ1dGVPcGNvZGUgZXh0ZW5kcyBET01VcGRhdGluZ09wY29kZSB7XG4gIHB1YmxpYyB0eXBlID0gXCJ1cGRhdGUtYXR0cmlidXRlXCI7XG5cbiAgcHJpdmF0ZSBlbGVtZW50OiBFbGVtZW50O1xuICBwcml2YXRlIG5hbWU6IHN0cmluZztcbiAgcHJpdmF0ZSBuYW1lc3BhY2U6IHN0cmluZztcbiAgcHJpdmF0ZSByZWZlcmVuY2U6IENoYWluYWJsZVJlZmVyZW5jZTtcbiAgcHJpdmF0ZSBsYXN0VmFsdWU6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcihlbGVtZW50OiBFbGVtZW50LCBuYW1lOiBzdHJpbmcsIHJlZmVyZW5jZTogQ2hhaW5hYmxlUmVmZXJlbmNlLCBsYXN0VmFsdWU6IHN0cmluZywgbmFtZXNwYWNlPzogc3RyaW5nKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgdGhpcy5yZWZlcmVuY2UgPSByZWZlcmVuY2U7XG4gICAgdGhpcy5sYXN0VmFsdWUgPSBsYXN0VmFsdWU7XG4gICAgdGhpcy5uYW1lc3BhY2UgPSBuYW1lc3BhY2U7XG4gIH1cblxuICBldmFsdWF0ZSh2bTogVXBkYXRpbmdWTSkge1xuICAgIGxldCB2YWx1ZSA9IHRoaXMucmVmZXJlbmNlLnZhbHVlKCk7XG5cbiAgICBpZiAodmFsdWUgIT09IHRoaXMubGFzdFZhbHVlKSB7XG4gICAgICBpZiAodGhpcy5uYW1lc3BhY2UpIHtcbiAgICAgICAgdm0uZG9tLnNldEF0dHJpYnV0ZU5TKHRoaXMuZWxlbWVudCwgdGhpcy5uYW1lLCB2YWx1ZSwgdGhpcy5uYW1lc3BhY2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdm0uZG9tLnNldEF0dHJpYnV0ZSh0aGlzLmVsZW1lbnQsIHRoaXMubmFtZSwgdmFsdWUpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxhc3RWYWx1ZSA9IHZhbHVlO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgRHluYW1pY1Byb3BPcGNvZGUgZXh0ZW5kcyBET01PcGNvZGUge1xuICBwdWJsaWMgdHlwZSA9IFwiZHluYW1pYy1wcm9wXCI7XG4gIHB1YmxpYyBuYW1lOiBJbnRlcm5lZFN0cmluZztcbiAgcHVibGljIHZhbHVlOiBJbnRlcm5lZFN0cmluZztcblxuICBjb25zdHJ1Y3RvcihhdHRyOiBEeW5hbWljUHJvcCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5uYW1lID0gYXR0ci5uYW1lO1xuICB9XG5cbiAgZXZhbHVhdGUodm06IFZNKSB7XG4gICAgbGV0IHsgbmFtZSB9ID0gdGhpcztcbiAgICBsZXQgZWxlbWVudCA9IHZtLnN0YWNrKCkuZWxlbWVudDtcbiAgICBsZXQgcmVmZXJlbmNlID0gdm0uZnJhbWUuZ2V0T3BlcmFuZCgpO1xuICAgIGxldCB2YWx1ZSA9IHJlZmVyZW5jZS52YWx1ZSgpO1xuXG4gICAgZWxlbWVudFs8c3RyaW5nPm5hbWVdID0gdmFsdWU7XG5cbiAgICB2bS51cGRhdGVXaXRoKG5ldyBVcGRhdGVQcm9wZXJ0eU9wY29kZShlbGVtZW50LCBuYW1lLCByZWZlcmVuY2UsIHZhbHVlKSk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFVwZGF0ZVByb3BlcnR5T3Bjb2RlIGV4dGVuZHMgRE9NVXBkYXRpbmdPcGNvZGUge1xuICBwdWJsaWMgdHlwZSA9IFwidXBkYXRlLXByb3BlcnR5XCI7XG5cbiAgcHJpdmF0ZSBlbGVtZW50OiBFbGVtZW50O1xuICBwcml2YXRlIG5hbWU6IHN0cmluZztcbiAgcHJpdmF0ZSByZWZlcmVuY2U6IENoYWluYWJsZVJlZmVyZW5jZTtcbiAgcHJpdmF0ZSBsYXN0VmFsdWU6IGFueTtcblxuICBjb25zdHJ1Y3RvcihlbGVtZW50OiBFbGVtZW50LCBuYW1lOiBzdHJpbmcsIHJlZmVyZW5jZTogQ2hhaW5hYmxlUmVmZXJlbmNlLCBsYXN0VmFsdWU6IGFueSkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIHRoaXMucmVmZXJlbmNlID0gcmVmZXJlbmNlO1xuICAgIHRoaXMubGFzdFZhbHVlID0gbGFzdFZhbHVlO1xuICB9XG5cbiAgZXZhbHVhdGUodm06IFVwZGF0aW5nVk0pIHtcbiAgICBsZXQgdmFsdWUgPSB0aGlzLnJlZmVyZW5jZS52YWx1ZSgpO1xuXG4gICAgaWYgKHZhbHVlICE9PSB0aGlzLmxhc3RWYWx1ZSkge1xuICAgICAgdGhpcy5sYXN0VmFsdWUgPSB0aGlzLmVsZW1lbnRbdGhpcy5uYW1lXSA9IHZhbHVlO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQWRkQ2xhc3NPcGNvZGUgZXh0ZW5kcyBET01PcGNvZGUge1xuICBwdWJsaWMgdHlwZSA9IFwiYWRkLWNsYXNzXCI7XG5cbiAgZXZhbHVhdGUodm06IFZNKSB7XG4gICAgdm0uc3RhY2soKS5hZGRDbGFzcyh2bS5mcmFtZS5nZXRPcGVyYW5kKCkpO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDb21tZW50T3Bjb2RlIGV4dGVuZHMgRE9NT3Bjb2RlIHtcbiAgcHVibGljIHR5cGUgPSBcImNvbW1lbnRcIjtcbiAgcHVibGljIHZhbHVlOiBJbnRlcm5lZFN0cmluZztcblxuICBjb25zdHJ1Y3Rvcihjb21tZW50OiBDb21tZW50KSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLnZhbHVlID0gY29tbWVudC52YWx1ZTtcbiAgfVxuXG4gIGV2YWx1YXRlKHZtOiBWTSkge1xuICAgIHZtLnN0YWNrKCkuYXBwZW5kQ29tbWVudCh0aGlzLnZhbHVlKTtcbiAgfVxufVxuIl19