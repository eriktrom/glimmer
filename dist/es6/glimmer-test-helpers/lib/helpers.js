import { tokenize } from "simple-html-tokenizer";
import { forEach } from "glimmer-util";
export function equalInnerHTML(fragment, html, msg) {
    var actualHTML = normalizeInnerHTML(fragment.innerHTML);
    QUnit.push(actualHTML === html, actualHTML, html, msg);
}
export function equalHTML(node, html) {
    var fragment;
    if (!node.nodeType && node.length) {
        fragment = document.createDocumentFragment();
        while (node[0]) {
            fragment.appendChild(node[0]);
        }
    }
    else {
        fragment = node;
    }
    var div = document.createElement("div");
    div.appendChild(fragment.cloneNode(true));
    equalInnerHTML(div, html);
}
function generateTokens(divOrHTML) {
    var div;
    if (typeof divOrHTML === 'string') {
        div = document.createElement("div");
        div.innerHTML = divOrHTML;
    }
    else {
        div = divOrHTML;
    }
    return { tokens: tokenize(div.innerHTML), html: div.innerHTML };
}
export function equalTokens(fragment, html, message = null) {
    if (fragment.fragment) {
        fragment = fragment.fragment;
    }
    if (html.fragment) {
        html = html.fragment;
    }
    var fragTokens = generateTokens(fragment);
    var htmlTokens = generateTokens(html);
    function normalizeTokens(token) {
        if (token.type === 'StartTag') {
            token.attributes = token.attributes.sort(function (a, b) {
                if (a[0] > b[0]) {
                    return 1;
                }
                if (a[0] < b[0]) {
                    return -1;
                }
                return 0;
            });
        }
    }
    forEach(fragTokens.tokens, normalizeTokens);
    forEach(htmlTokens.tokens, normalizeTokens);
    // var msg = "Expected: " + htmlTokens.html + "; Actual: " + fragTokens.html;
    // if (message) { msg += " (" + message + ")"; }
    let equiv = QUnit.equiv(fragTokens.tokens, htmlTokens.tokens);
    if (equiv && fragTokens.html !== htmlTokens.html) {
        deepEqual(fragTokens.tokens, htmlTokens.tokens, message);
    }
    else {
        QUnit.push(QUnit.equiv(fragTokens.tokens, htmlTokens.tokens), fragTokens.html, htmlTokens.html, message);
    }
    // deepEqual(fragTokens.tokens, htmlTokens.tokens, msg);
}
// detect side-effects of cloning svg elements in IE9-11
var ieSVGInnerHTML = (function () {
    if (!document.createElementNS) {
        return false;
    }
    var div = document.createElement('div');
    var node = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    div.appendChild(node);
    var clone = div.cloneNode(true);
    return clone.innerHTML === '<svg xmlns="http://www.w3.org/2000/svg" />';
})();
export function normalizeInnerHTML(actualHTML) {
    if (ieSVGInnerHTML) {
        // Replace `<svg xmlns="http://www.w3.org/2000/svg" height="50%" />` with `<svg height="50%"></svg>`, etc.
        // drop namespace attribute
        actualHTML = actualHTML.replace(/ xmlns="[^"]+"/, '');
        // replace self-closing elements
        actualHTML = actualHTML.replace(/<([^ >]+) [^\/>]*\/>/gi, function (tag, tagName) {
            return tag.slice(0, tag.length - 3) + '></' + tagName + '>';
        });
    }
    return actualHTML;
}
// detect weird IE8 checked element string
var checkedInput = document.createElement('input');
checkedInput.setAttribute('checked', 'checked');
var checkedInputString = checkedInput.outerHTML;
export function isCheckedInputHTML(element) {
    equal(element.outerHTML, checkedInputString);
}
// check which property has the node's text content
var textProperty = document.createElement('div').textContent === undefined ? 'innerText' : 'textContent';
export function getTextContent(el) {
    // textNode
    if (el.nodeType === 3) {
        return el.nodeValue;
    }
    else {
        return el[textProperty];
    }
}
export function strip(strings) {
    return strings[0].split('\n').map(s => s.trim()).join(' ');
}
export function stripTight(strings) {
    return strings[0].split('\n').map(s => s.trim()).join('');
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImdsaW1tZXItdGVzdC1oZWxwZXJzL2xpYi9oZWxwZXJzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sdUJBQXVCO09BQ3pDLEVBQUUsT0FBTyxFQUFFLE1BQU0sY0FBYztBQUV0QywrQkFBK0IsUUFBUSxFQUFFLElBQUksRUFBRSxHQUFJO0lBQ2pELElBQUksVUFBVSxHQUFHLGtCQUFrQixDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUN4RCxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQVUsS0FBSyxJQUFJLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztBQUN6RCxDQUFDO0FBRUQsMEJBQTBCLElBQUksRUFBRSxJQUFJO0lBQ2xDLElBQUksUUFBUSxDQUFDO0lBQ2IsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQ2xDLFFBQVEsR0FBRyxRQUFRLENBQUMsc0JBQXNCLEVBQUUsQ0FBQztRQUM3QyxPQUFPLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQ2YsUUFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNoQyxDQUFDO0lBQ0gsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ04sUUFBUSxHQUFHLElBQUksQ0FBQztJQUNsQixDQUFDO0lBRUQsSUFBSSxHQUFHLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN4QyxHQUFHLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUUxQyxjQUFjLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQzVCLENBQUM7QUFFRCx3QkFBd0IsU0FB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UyxDQUFDO0FBQ2hELG1DQUFtQyxPQUFPO0lBQ3hDLEtBQUssQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLGtCQUFrQixDQUFDLENBQUM7QUFDL0MsQ0FBQztBQUVELG1EQUFtRDtBQUNuRCxJQUFJLFlBQVksR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDLFdBQVcsS0FBSyxTQUFTLEdBQUcsV0FBVyxHQUFHLGFBQWEsQ0FBQztBQUN6RywrQkFBK0IsRUFBRTtJQUMvQixXQUFXO0lBQ1gsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLFFBQVEsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3RCLE1BQU0sQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDO0lBQ3RCLENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNOLE1BQU0sQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDMUIsQ0FBQztBQUNILENBQUM7QUFFRCxzQkFBc0IsT0FBaUI7SUFDckMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDN0QsQ0FBQztBQUVELDJCQUEyQixPQUFpQjtJQUMxQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUM1RCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdG9rZW5pemUgfSBmcm9tIFwic2ltcGxlLWh0bWwtdG9rZW5pemVyXCI7XG5pbXBvcnQgeyBmb3JFYWNoIH0gZnJvbSBcImdsaW1tZXItdXRpbFwiO1xuXG5leHBvcnQgZnVuY3Rpb24gZXF1YWxJbm5lckhUTUwoZnJhZ21lbnQsIGh0bWwsIG1zZz8pIHtcbiAgdmFyIGFjdHVhbEhUTUwgPSBub3JtYWxpemVJbm5lckhUTUwoZnJhZ21lbnQuaW5uZXJIVE1MKTtcbiAgUVVuaXQucHVzaChhY3R1YWxIVE1MID09PSBodG1sLCBhY3R1YWxIVE1MLCBodG1sLCBtc2cpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZXF1YWxIVE1MKG5vZGUsIGh0bWwpIHtcbiAgdmFyIGZyYWdtZW50O1xuICBpZiAoIW5vZGUubm9kZVR5cGUgJiYgbm9kZS5sZW5ndGgpIHtcbiAgICBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICB3aGlsZSAobm9kZVswXSkge1xuICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQobm9kZVswXSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGZyYWdtZW50ID0gbm9kZTtcbiAgfVxuXG4gIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBkaXYuYXBwZW5kQ2hpbGQoZnJhZ21lbnQuY2xvbmVOb2RlKHRydWUpKTtcblxuICBlcXVhbElubmVySFRNTChkaXYsIGh0bWwpO1xufVxuXG5mdW5jdGlvbiBnZW5lcmF0ZVRva2VucyhkaXZPckhUTUwpIHtcbiAgdmFyIGRpdjtcbiAgaWYgKHR5cGVvZiBkaXZPckhUTUwgPT09ICdzdHJpbmcnKSB7XG4gICAgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBkaXYuaW5uZXJIVE1MID0gZGl2T3JIVE1MO1xuICB9IGVsc2Uge1xuICAgIGRpdiA9IGRpdk9ySFRNTDtcbiAgfVxuXG4gIHJldHVybiB7IHRva2VuczogdG9rZW5pemUoZGl2LmlubmVySFRNTCksIGh0bWw6IGRpdi5pbm5lckhUTUwgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGVxdWFsVG9rZW5zKGZyYWdtZW50LCBodG1sLCBtZXNzYWdlPW51bGwpIHtcbiAgaWYgKGZyYWdtZW50LmZyYWdtZW50KSB7IGZyYWdtZW50ID0gZnJhZ21lbnQuZnJhZ21lbnQ7IH1cbiAgaWYgKGh0bWwuZnJhZ21lbnQpIHsgaHRtbCA9IGh0bWwuZnJhZ21lbnQ7IH1cblxuICB2YXIgZnJhZ1Rva2VucyA9IGdlbmVyYXRlVG9rZW5zKGZyYWdtZW50KTtcbiAgdmFyIGh0bWxUb2tlbnMgPSBnZW5lcmF0ZVRva2VucyhodG1sKTtcblxuICBmdW5jdGlvbiBub3JtYWxpemVUb2tlbnModG9rZW4pIHtcbiAgICBpZiAodG9rZW4udHlwZSA9PT0gJ1N0YXJ0VGFnJykge1xuICAgICAgdG9rZW4uYXR0cmlidXRlcyA9IHRva2VuLmF0dHJpYnV0ZXMuc29ydChmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgIGlmIChhWzBdID4gYlswXSkgeyByZXR1cm4gMTsgfVxuICAgICAgICBpZiAoYVswXSA8IGJbMF0pIHsgcmV0dXJuIC0xOyB9XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgZm9yRWFjaChmcmFnVG9rZW5zLnRva2Vucywgbm9ybWFsaXplVG9rZW5zKTtcbiAgZm9yRWFjaChodG1sVG9rZW5zLnRva2Vucywgbm9ybWFsaXplVG9rZW5zKTtcblxuICAvLyB2YXIgbXNnID0gXCJFeHBlY3RlZDogXCIgKyBodG1sVG9rZW5zLmh0bWwgKyBcIjsgQWN0dWFsOiBcIiArIGZyYWdUb2tlbnMuaHRtbDtcblxuICAvLyBpZiAobWVzc2FnZSkgeyBtc2cgKz0gXCIgKFwiICsgbWVzc2FnZSArIFwiKVwiOyB9XG5cbiAgbGV0IGVxdWl2ID0gUVVuaXQuZXF1aXYoZnJhZ1Rva2Vucy50b2tlbnMsIGh0bWxUb2tlbnMudG9rZW5zKTtcblxuICBpZiAoZXF1aXYgJiYgZnJhZ1Rva2Vucy5odG1sICE9PSBodG1sVG9rZW5zLmh0bWwpIHtcbiAgICBkZWVwRXF1YWwoZnJhZ1Rva2Vucy50b2tlbnMsIGh0bWxUb2tlbnMudG9rZW5zLCBtZXNzYWdlKTtcbiAgfSBlbHNlIHtcbiAgICBRVW5pdC5wdXNoKFFVbml0LmVxdWl2KGZyYWdUb2tlbnMudG9rZW5zLCBodG1sVG9rZW5zLnRva2VucyksIGZyYWdUb2tlbnMuaHRtbCwgaHRtbFRva2Vucy5odG1sLCBtZXNzYWdlKTtcbiAgfVxuXG4gIC8vIGRlZXBFcXVhbChmcmFnVG9rZW5zLnRva2VucywgaHRtbFRva2Vucy50b2tlbnMsIG1zZyk7XG59XG5cbi8vIGRldGVjdCBzaWRlLWVmZmVjdHMgb2YgY2xvbmluZyBzdmcgZWxlbWVudHMgaW4gSUU5LTExXG52YXIgaWVTVkdJbm5lckhUTUwgPSAoZnVuY3Rpb24gKCkge1xuICBpZiAoIWRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIHZhciBub2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdzdmcnKTtcbiAgZGl2LmFwcGVuZENoaWxkKG5vZGUpO1xuICB2YXIgY2xvbmUgPSA8SFRNTERpdkVsZW1lbnQ+ZGl2LmNsb25lTm9kZSh0cnVlKTtcbiAgcmV0dXJuIGNsb25lLmlubmVySFRNTCA9PT0gJzxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIC8+Jztcbn0pKCk7XG5cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVJbm5lckhUTUwoYWN0dWFsSFRNTCkge1xuICBpZiAoaWVTVkdJbm5lckhUTUwpIHtcbiAgICAvLyBSZXBsYWNlIGA8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiBoZWlnaHQ9XCI1MCVcIiAvPmAgd2l0aCBgPHN2ZyBoZWlnaHQ9XCI1MCVcIj48L3N2Zz5gLCBldGMuXG4gICAgLy8gZHJvcCBuYW1lc3BhY2UgYXR0cmlidXRlXG4gICAgYWN0dWFsSFRNTCA9IGFjdHVhbEhUTUwucmVwbGFjZSgvIHhtbG5zPVwiW15cIl0rXCIvLCAnJyk7XG4gICAgLy8gcmVwbGFjZSBzZWxmLWNsb3NpbmcgZWxlbWVudHNcbiAgICBhY3R1YWxIVE1MID0gYWN0dWFsSFRNTC5yZXBsYWNlKC88KFteID5dKykgW15cXC8+XSpcXC8+L2dpLCBmdW5jdGlvbih0YWcsIHRhZ05hbWUpIHtcbiAgICAgIHJldHVybiB0YWcuc2xpY2UoMCwgdGFnLmxlbmd0aCAtIDMpICsgJz48LycgKyB0YWdOYW1lICsgJz4nO1xuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIGFjdHVhbEhUTUw7XG59XG5cbi8vIGRldGVjdCB3ZWlyZCBJRTggY2hlY2tlZCBlbGVtZW50IHN0cmluZ1xudmFyIGNoZWNrZWRJbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG5jaGVja2VkSW5wdXQuc2V0QXR0cmlidXRlKCdjaGVja2VkJywgJ2NoZWNrZWQnKTtcbnZhciBjaGVja2VkSW5wdXRTdHJpbmcgPSBjaGVja2VkSW5wdXQub3V0ZXJIVE1MO1xuZXhwb3J0IGZ1bmN0aW9uIGlzQ2hlY2tlZElucHV0SFRNTChlbGVtZW50KSB7XG4gIGVxdWFsKGVsZW1lbnQub3V0ZXJIVE1MLCBjaGVja2VkSW5wdXRTdHJpbmcpO1xufVxuXG4vLyBjaGVjayB3aGljaCBwcm9wZXJ0eSBoYXMgdGhlIG5vZGUncyB0ZXh0IGNvbnRlbnRcbnZhciB0ZXh0UHJvcGVydHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKS50ZXh0Q29udGVudCA9PT0gdW5kZWZpbmVkID8gJ2lubmVyVGV4dCcgOiAndGV4dENvbnRlbnQnO1xuZXhwb3J0IGZ1bmN0aW9uIGdldFRleHRDb250ZW50KGVsKSB7XG4gIC8vIHRleHROb2RlXG4gIGlmIChlbC5ub2RlVHlwZSA9PT0gMykge1xuICAgIHJldHVybiBlbC5ub2RlVmFsdWU7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGVsW3RleHRQcm9wZXJ0eV07XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHN0cmlwKHN0cmluZ3M6IHN0cmluZ1tdKSB7XG4gIHJldHVybiBzdHJpbmdzWzBdLnNwbGl0KCdcXG4nKS5tYXAocyA9PiBzLnRyaW0oKSkuam9pbignICcpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc3RyaXBUaWdodChzdHJpbmdzOiBzdHJpbmdbXSkge1xuICByZXR1cm4gc3RyaW5nc1swXS5zcGxpdCgnXFxuJykubWFwKHMgPT4gcy50cmltKCkpLmpvaW4oJycpO1xufSJdfQ==